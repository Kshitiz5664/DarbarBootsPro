{% extends 'wholesale/base.html' %}
{% load static %}
{% block content %}

<style>
  /* ==================== VARIABLES ==================== */
  :root {
    --color-primary: #0d6efd;
    --color-success: #28a745;
    --color-danger: #dc3545;
    --color-warning: #ffc107;
    --color-info: #0dcaf0;
    --color-text-muted: #6c757d;
    --border-radius-sm: 8px;
    --border-radius-md: 12px;
    --spacing-xs: 8px;
    --spacing-sm: 12px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    --transition-default: all 0.3s ease;
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  /* ==================== CONTAINER ==================== */
  .detail-container {
    padding: var(--spacing-lg) var(--spacing-md);
    max-width: 1400px;
    margin: 0 auto;
  }

  /* ==================== HEADER ==================== */
  .detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
    gap: var(--spacing-md);
    flex-wrap: wrap;
  }

  .detail-title {
    font-weight: 700;
    color: var(--color-primary);
    margin: 0;
    font-size: clamp(1.5rem, 4vw, 2rem);
  }

  .header-actions {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
  }

  .btn-action {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-sm) var(--spacing-md);
    font-size: clamp(0.85rem, 2vw, 0.95rem);
    font-weight: 600;
    white-space: nowrap;
  }

  /* ==================== KPI CARDS ==================== */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
  }

  .kpi-card {
    border-radius: var(--border-radius-md);
    border: none;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }

  .kpi-body {
    text-align: center;
    padding: var(--spacing-lg);
  }

  .kpi-label {
    color: var(--color-text-muted);
    font-size: clamp(0.85rem, 2vw, 0.95rem);
    margin-bottom: var(--spacing-xs);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
  }

  .kpi-value {
    font-weight: 700;
    font-size: clamp(1.3rem, 3vw, 1.8rem);
    margin: 0;
  }

  /* ==================== DATA CARDS ==================== */
  .data-card {
    border-radius: var(--border-radius-md);
    border: none;
    box-shadow: var(--shadow-sm);
    margin-bottom: var(--spacing-lg);
    overflow: hidden;
  }

  .card-header-custom {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    padding: var(--spacing-md);
    border-bottom: 1px solid #dee2e6;
    font-weight: 600;
    font-size: clamp(0.95rem, 2vw, 1.05rem);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
  }

  /* ==================== TABLE ==================== */
  .data-table {
    margin-bottom: 0;
    font-size: clamp(0.85rem, 2vw, 0.95rem);
  }

  .data-table thead {
    background-color: #f8f9fa;
  }

  .data-table th {
    font-weight: 600;
    color: var(--color-text-muted);
    text-transform: uppercase;
    font-size: clamp(0.75rem, 2vw, 0.85rem);
    letter-spacing: 0.5px;
    padding: var(--spacing-md);
    border-bottom: 2px solid #dee2e6;
  }

  .data-table td {
    padding: var(--spacing-md);
    vertical-align: middle;
  }

  .data-table tbody tr {
    transition: background-color 0.2s ease;
  }

  .data-table tbody tr:hover {
    background-color: rgba(0, 123, 255, 0.05);
  }

  /* ==================== BADGES ==================== */
  .status-badge {
    font-size: clamp(0.75rem, 2vw, 0.85rem);
    padding: 4px 12px;
    border-radius: 20px;
    font-weight: 600;
  }

  /* ==================== EMPTY STATE ==================== */
  .empty-state {
    text-align: center;
    padding: var(--spacing-xl) var(--spacing-md);
    color: var(--color-text-muted);
  }

  /* ==================== RESPONSIVE DESIGN ==================== */
  @media (max-width: 992px) {
    .kpi-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .data-table {
      font-size: 0.85rem;
    }

    .data-table th,
    .data-table td {
      padding: var(--spacing-sm);
    }
  }

  @media (max-width: 768px) {
    .detail-container {
      padding: var(--spacing-md) var(--spacing-sm);
    }

    .detail-header {
      flex-direction: column;
      align-items: stretch;
    }

    .header-actions {
      flex-direction: column;
    }

    .btn-action {
      justify-content: center;
    }

    .kpi-grid {
      grid-template-columns: 1fr;
    }

    /* Hide less important columns on mobile */
    .data-table th:nth-child(2),
    .data-table td:nth-child(2) {
      display: none;
    }
  }

  @media (max-width: 480px) {
    .kpi-body {
      padding: var(--spacing-md);
    }

    .card-header-custom {
      padding: var(--spacing-sm) var(--spacing-md);
      font-size: 0.9rem;
    }

    /* Show only essential table columns */
    .data-table th:nth-child(4),
    .data-table td:nth-child(4) {
      display: none;
    }
  }

  /* ==================== TOUCH OPTIMIZATIONS ==================== */
  @media (hover: none) and (pointer: coarse) {
    .btn-action {
      -webkit-tap-highlight-color: transparent;
    }

    .btn-action:active {
      transform: scale(0.98);
    }
  }

  /* ==================== PRINT STYLES ==================== */
  @media print {
    .detail-header,
    .header-actions {
      display: none;
    }

    .kpi-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing-sm);
    }

    .data-table {
      font-size: 9pt;
    }

    .data-card {
      page-break-inside: avoid;
    }
  }
</style>

<div class="detail-container">
  <!-- Header -->
  <div class="detail-header">
    <h3 class="detail-title">{{ party.name }}</h3>
    <div class="header-actions">
      <a href="{% url 'party:party_edit' party.id %}" class="btn btn-outline-primary btn-action">
        <i class="bi bi-pencil-square"></i>
        <span>Edit</span>
      </a>
      <a href="{% url 'party:send_reminder' party.id %}" class="btn btn-success btn-action">
        <i class="bi bi-whatsapp"></i>
        <span>Send Reminder</span>
      </a>
      <a href="{% url 'party:party_list' %}" class="btn btn-outline-secondary btn-action">
        <i class="bi bi-arrow-left"></i>
        <span>Back</span>
      </a>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="kpi-grid">
    <div class="card kpi-card">
      <div class="card-body kpi-body">
        <h6 class="kpi-label">Total Invoiced</h6>
        <h4 class="kpi-value">₹{{ kpi.total_invoiced|floatformat:2 }}</h4>
      </div>
    </div>

    <div class="card kpi-card">
      <div class="card-body kpi-body">
        <h6 class="kpi-label">Total Paid</h6>
        <h4 class="kpi-value text-success">₹{{ kpi.total_paid|floatformat:2 }}</h4>
      </div>
    </div>

    <div class="card kpi-card">
      <div class="card-body kpi-body">
        <h6 class="kpi-label">Pending</h6>
        <h4 class="kpi-value text-danger">₹{{ kpi.pending|floatformat:2 }}</h4>
      </div>
    </div>

    <div class="card kpi-card">
      <div class="card-body kpi-body">
        <h6 class="kpi-label">Invoices</h6>
        <h4 class="kpi-value">
          <span class="text-warning">{{ kpi.open_invoices }}</span> / 
          <span class="text-success">{{ kpi.closed_invoices }}</span>
        </h4>
      </div>
    </div>
  </div>

  <!-- Invoice Table -->
  <div class="card data-card">
    <div class="card-header card-header-custom">
      <i class="bi bi-receipt"></i>
      <span>Invoice Details</span>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table data-table align-middle table-hover">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Total</th>
              <th>Paid</th>
              <th>Balance</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in invoice_details %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ entry.invoice.date|date:"d M Y" }}</td>
              <td>₹{{ entry.invoice.total_amount|floatformat:2 }}</td>
              <td class="text-success fw-semibold">₹{{ entry.total_paid|floatformat:2 }}</td>
              <td class="text-danger fw-semibold">₹{{ entry.balance|floatformat:2 }}</td>
              <td>
                <span class="badge status-badge {% if entry.status == 'Closed' %}bg-success{% else %}bg-warning text-dark{% endif %}">
                  {{ entry.status }}
                </span>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="empty-state">
                <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                <p class="mb-0 mt-2">No invoices available</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Payment Table -->
  <div class="card data-card">
    <div class="card-header card-header-custom">
      <i class="bi bi-cash-coin"></i>
      <span>Payment History</span>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table data-table align-middle table-hover">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Invoice</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            {% for payment in payments %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ payment.date|date:"d M Y" }}</td>
              <td>{{ payment.invoice.invoice_number }}</td>
              <td class="text-success fw-semibold">₹{{ payment.amount|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="empty-state">
                <i class="bi bi-cash" style="font-size: 3rem; opacity: 0.3;"></i>
                <p class="mb-0 mt-2">No payments found</p>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';

  document.addEventListener('DOMContentLoaded', function() {
    // Add animation to cards on scroll
    const cards = document.querySelectorAll('.kpi-card, .data-card');
    
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          entry.target.style.animation = 'fadeIn 0.5s ease-out';
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    cards.forEach(function(card) {
      observer.observe(card);
    });
  });
})();
</script>

{% endblock %}